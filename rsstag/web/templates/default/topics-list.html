<html>

<head>
    <title>Topics/Chapters List</title>
    {% include "head-data.html" %}
</head>

<body>
    {% import 'main-menu.html' as menu with context %}{% import 'global-status.html' as g_status with context %}{% from
    'context-filter-bar.html' import context_filter_bar with context %}

    <div id="global_tools">
        <div class="left_half">
            <div id="link_on_root" class="global_tools_button">
                <a href="/">main</a>
            </div>
            <div id="help_button" class="global_tools_button">
                <a href="#">help</a>
            </div>
        </div>
        <div class="right_half">
            {{ g_status.global_status() }}
            {{ menu.settings_menu() }}
        </div>
    </div>

    {{ context_filter_bar() }}
    <div class="page topics-list-page">
        <h1>Topics/Chapters List</h1>
        <div class="search_tools topics-search">
            <input id="topics_search_field" class="search_field" type="text" placeholder="Search topics" />
            <div id="topics_search_result" class="search_result"></div>
        </div>

        <div class="topics-tabs">
            <div class="tab-header">
                <div class="tab-btn active" data-tab="topics-list">Topics List</div>
                <div class="tab-btn" data-tab="topics-chart">Topics Sunburst Chart</div>
                <div class="tab-btn" data-tab="topics-marimekko">Topics Marimekko Chart</div>
            </div>
            <div id="tab-topics-list" class="tab-content active">
                <div id="topics_list_container">
                    <div class="topics-tree-controls">
                        <button id="topics_fold_all" type="button" class="topics-tree-btn">Fold all</button>
                        <button id="topics_unfold_all" type="button" class="topics-tree-btn">Unfold all</button>
                    </div>
                    {% macro render_topic_node(node, level=0) -%}
                    {% set all_post_ids = node.posts|join('_') %}
                    <div class="topic-tree-node level-{{ level }}">
                        {% if node.children|length > 0 %}
                        <details class="topic-tree-details">
                            <summary class="topic-header">
                                <span class="topic-link" title="{{ node.path }}">{{ node.name }}</span>
                                <a href="/post-grouped/{{ all_post_ids }}?topic={{ node.path|url_encode }}" class="snippet-link"
                                    title="Grouped posts">G</a>
                                <a href="/post-grouped-snippets/{{ all_post_ids }}?topic={{ node.path|url_encode }}" class="snippet-link"
                                    title="Grouped snippets">S</a>
                                <span class="topic-count">({{ node.count }})</span>
                            </summary>
                            <div class="topic-children">
                                {% for child in node.children %}
                                {{ render_topic_node(child, level + 1) }}
                                {% endfor %}
                            </div>
                        </details>
                        {% else %}
                        <div class="topic-header">
                            <span class="topic-link" title="{{ node.path }}">{{ node.name }}</span>
                            <a href="/post-grouped/{{ all_post_ids }}?topic={{ node.path|url_encode }}" class="snippet-link"
                                title="Grouped posts">G</a>
                            <a href="/post-grouped-snippets/{{ all_post_ids }}?topic={{ node.path|url_encode }}" class="snippet-link"
                                title="Grouped snippets">S</a>
                            <span class="topic-count">({{ node.count }})</span>
                        </div>
                        {% endif %}
                    </div>
                    {%- endmacro %}

                    <div class="topics-tree">
                        {% for topic_node in topics_tree %}
                        {{ render_topic_node(topic_node) }}
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div id="tab-topics-chart" class="tab-content">
                <div class="topics-chart-wrapper">
                    <div id="topics_sunburst_chart" class="topics-sunburst-chart"></div>
                </div>
            </div>
            <div id="tab-topics-marimekko" class="tab-content">
                <div class="topics-chart-wrapper">
                    <div id="topics_marimekko_chart"></div>
                </div>
            </div>
        </div>

    </div>

    <div id="global_tools_bottom">
        <ul id="paginator">
            {% if pages_map['start'] %}
            {% for number in pages_map['start'] %}
            {% if number['p'] == current_page %}
            <li class="current_page">{{number['p']}}</li>
            {% else %}
            <li><a href="{{number['url']}}">{{number['p']}}</a></li>
            {% endif %}
            {% endfor %}
            {% if pages_map['middle'] %}
            <li>....</li>
            {% endif %}
            {% endif %}
            {% if pages_map['middle'] %}
            {% for number in pages_map['middle'] %}
            {% if number['p'] == current_page %}
            <li class="current_page">{{number['p']}}</li>
            {% else %}
            <li><a href="{{number['url']}}">{{number['p']}}</a></li>
            {% endif %}
            {% endfor %}
            {% endif %}
            {% if pages_map['end'] %}
            <li>....</li>
            {% for number in pages_map['end'] %}
            {% if number['p'] == current_page %}
            <li class="current_page">{{number['p']}}</li>
            {% else %}
            <li><a href="{{number['url']}}">{{number['p']}}</a></li>
            {% endif %}
            {% endfor %}
            {% endif %}
        </ul>
    </div>

    <script type="text/javascript">
        window.sunburst_data = {{ sunburst_data | tojson | safe }};
    </script>
    <script type="text/javascript" src="/static/js/bundle.js"></script>

</body>

</html>
