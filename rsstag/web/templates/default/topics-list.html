<html>

<head>
    <title>Topics/Chapters List</title>
    {% include "head-data.html" %}
</head>

<body>
    {% import 'main-menu.html' as menu with context %}{% import 'global-status.html' as g_status with context %}

    <div id="global_tools">
        <div class="left_half">
            <div id="link_on_root" class="global_tools_button">
                <a href="/">main</a>
            </div>
            <div id="help_button" class="global_tools_button">
                <a href="#">help</a>
            </div>
        </div>
        <div class="right_half">
            {{ g_status.global_status() }}
            {{ menu.settings_menu() }}
        </div>
    </div>

    <div class="page topics-list-page">
        <h1>Topics/Chapters List</h1>

        <div id="topics_list_container">
            <div class="topics-cloud">
                {% for topic_name, topic_data in topics %}
                <div class="topic-item">
                    <div class="topic-header">
                        {% set all_post_ids = topic_data.posts|join('_') %}
                        <a href="/post-grouped/{{ all_post_ids }}" class="topic-link" title="{{ topic_name }}">{{
                            topic_name[:60] }}{% if topic_name|length > 60 %}...{% endif %}</a>
                        <a href="/post-grouped-snippets/{{ all_post_ids }}?topic={{ topic_name|url_encode }}" class="snippet-link"
                            title="View snippets">S</a>
                        <span class="topic-count">({{ topic_data.count }})</span>
                        {% if topic_data.posts|length > 0 %}
                        <button class="toggle-posts" onclick="togglePosts('{{ loop.index }}', event)">[{{
                            topic_data.posts|length }} posts]</button>
                        {% endif %}
                    </div>
                    {% if topic_data.posts|length > 0 %}
                    <div class="topic-posts" id="posts_{{ loop.index }}" style="display: none">
                        {% for post_id in topic_data.posts %}
                        {% set post_info = post_topic_mapping[post_id] %}
                        <div class="post-info">
                            <a href="/post-grouped/{{ post_id }}" title="{{ post_info.feed_title }}">{{
                                post_info.feed_title[:40] }}{% if post_info.feed_title|length > 40 %}...{% endif %}</a>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>

    </div>

    <div id="global_tools_bottom">
        <ul id="paginator">
            {% if pages_map['start'] %}
            {% for number in pages_map['start'] %}
            {% if number['p'] == current_page %}
            <li class="current_page">{{number['p']}}</li>
            {% else %}
            <li><a href="{{number['url']}}">{{number['p']}}</a></li>
            {% endif %}
            {% endfor %}
            {% if pages_map['middle'] %}
            <li>....</li>
            {% endif %}
            {% endif %}
            {% if pages_map['middle'] %}
            {% for number in pages_map['middle'] %}
            {% if number['p'] == current_page %}
            <li class="current_page">{{number['p']}}</li>
            {% else %}
            <li><a href="{{number['url']}}">{{number['p']}}</a></li>
            {% endif %}
            {% endfor %}
            {% endif %}
            {% if pages_map['end'] %}
            <li>....</li>
            {% for number in pages_map['end'] %}
            {% if number['p'] == current_page %}
            <li class="current_page">{{number['p']}}</li>
            {% else %}
            <li><a href="{{number['url']}}">{{number['p']}}</a></li>
            {% endif %}
            {% endfor %}
            {% endif %}
        </ul>
    </div>

    <script src="/static/js/topics-list.js"></script>

</body>

</html>
