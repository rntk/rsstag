<!DOCTYPE html />
<html>

<head>
    <title>Grouped Snippets | {{feed_title}}</title>
    {% include "head-data.html" %}
</head>

<body>
    {% import 'main-menu.html' as menu with context %}{% import 'global-status.html' as g_status with context %}{% from 'context-filter-bar.html' import context_filter_bar with context %}

    <div id="global_tools">
        <div class="left_half">
            <div id="link_on_root" class="global_tools_button">
                <a href="/">main</a>
            </div>
            <div id="help_button" class="global_tools_button">
                <a href="#">help</a>
            </div>
        </div>
        <div class="right_half">
            <div id="player_block" class="global_tools_button"></div>
            <div id="posts_stat" class="global_tools_button"></div>
            <div id="read_all" class="global_tools_button">
                <button class="batch-read-btn" data-action="read-all" type="button"
                    title="Mark all displayed snippets as read">Read all</button>
            </div>
            <div id="unread_all" class="global_tools_button">
                <button class="batch-read-btn" data-action="unread-all" type="button"
                    title="Mark all displayed snippets as unread">Unread all</button>
            </div>
            <div id="show_all" class="global_tools_button"></div>
            {{ g_status.global_status() }}
            {{ menu.settings_menu() }}
        </div>
    </div>
    {{ context_filter_bar() }}

    <div class="page post-grouped-snippets-page">
        <div class="back-nav">
            <a href="/post-grouped/{{post_id}}" class="back-btn">&larr; Back to Full Posts Grouped View</a>
            {% if current_topic %}
            <a href="/post-grouped-snippets/{{post_id}}" class="back-btn">Show All Topics</a>
            {% endif %}
        </div>

        <h2>Grouped Snippets: {{feed_title}}</h2>
        {% if current_topic %}
        <h3 class="filter-title">Filter: {{ current_topic }}</h3>
        {% endif %}

        <div id="snippets_container">
            {% if topics %}
            {% for topic_name, data in topics %}
            <div class="topic-card" style="border-left-color: {{ data.color }};">
                <div class="topic-header">
                    <span class="topic-title">{{ topic_name }}</span>
                    <span class="topic-count">{{ data.snippets|length }} snippets</span>
                </div>

                <div class="snippets-list">
                    {% for snippet in data.snippets %}
                    <div class="snippet-item {{ 'read' if snippet.read else '' }}"
                        id="snippet_{{ snippet.post_id }}_{{ snippet.indices | join('_') }}">
                        <div class="snippet-meta">
                            <span>
                                From <span class="source-tag snippet-source-info">{{
                                    snippet.post_title }}</span>
                            </span>
                            <span class="snippet-actions">
                                <span
                                    class="source-tag toggle-read-btn {{ 'snippet-tag-read' if snippet.read else 'snippet-tag-unread' }}"
                                    data-post-id="{{ snippet.post_id }}"
                                    data-indices="{{ snippet.indices | join(',') }}"
                                    data-read="{{ 1 if snippet.read else 0 }}"
                                    title="Mark as {{ 'unread' if snippet.read else 'read' }}">
                                    {{ 'Mark Unread' if snippet.read else 'Mark Read' }}
                                </span>
                                <a href="/post-grouped/{{post_id}}?highlight_sentence={{snippet.index}}#post_{{snippet.post_id}}"
                                    class="source-tag" title="See this sentence in the grouped full posts view">See in
                                    context</a>
                                <a href="/posts/{{snippet.post_id}}" class="source-tag snippet-tag-context"
                                    title="Show only this post content">Show full post</a>
                                {% if snippet.url %}
                                <a href="{{ snippet.url }}" target="_blank" class="source-tag snippet-tag-original"
                                    title="Go to source article">Original &nearr;</a>
                                {% endif %}
                            </span>
                        </div>
                        <div class="post-content-isolated">
                            <div class="snippet-text">{{ snippet.text }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="no-snippets-message">
                No grouped snippets found. The posts might not be processed yet or contain no recognized topics.
            </div>
            {% endif %}
        </div>
    </div>

    <div id="progressbar"></div>
    <script src="/static/js/post-grouped-snippets.js"></script>
</body>

</html>